name: Linux_Container_Workflow
on:
  push:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout GitHub Action üöÄ"
        uses: actions/checkout@main

      - name: "Login via Azure CLI üîë"
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: "Build and push image üö¢"
        uses: azure/docker-login@v1
        with:
          login-server: ${{ secrets.ACR_LOGIN_SERVER }}
          username: ${{ secrets.ACR_USERNAME }}
          password: ${{ secrets.ACR_PASSWORD }}

      - name: "Build and push image with Docker envs üõ†Ô∏è"
        run: |
          docker build \
            --build-arg NODE_ENV="${{ secrets.NODE_ENV }}" \
            --build-arg HOST="${{ secrets.HOST }}" \
            --build-arg PORT="${{ secrets.PORT }}" \
            --build-arg FRONTEND_URL="${{ secrets.FRONTEND_URL }}" \
            --build-arg MONGO_CONNECTION_STRING="${{ secrets.MONGO_CONNECTION_STRING }}" \
            --build-arg ACCESS_TOKEN_EXPIRES_IN="${{ secrets.ACCESS_TOKEN_EXPIRES_IN }}" \
            --build-arg REFRESH_TOKEN_EXPIRES_IN="${{ secrets.REFRESH_TOKEN_EXPIRES_IN }}" \
            --build-arg ACCESS_TOKEN_SECRET="${{ secrets.ACCESS_TOKEN_SECRET }}" \
            --build-arg REFRESH_TOKEN_SECRET="${{ secrets.REFRESH_TOKEN_SECRET }}" \
            --build-arg EMAIL_USER="${{ secrets.EMAIL_USER }}" \
            --build-arg EMAIL_APP_PASSWORD="${{ secrets.EMAIL_APP_PASSWORD }}" \
            --build-arg ACCOUNT_ACTIVATION_TOKEN_SECRET="${{ secrets.ACCOUNT_ACTIVATION_TOKEN_SECRET }}" \
            --build-arg ACCOUNT_ACTIVATION_TOKEN_EXPIRES_IN="${{ secrets.ACCOUNT_ACTIVATION_TOKEN_EXPIRES_IN }}" \
            --build-arg PASSWORD_RESET_TOKEN_SECRET="${{ secrets.PASSWORD_RESET_TOKEN_SECRET }}" \
            --build-arg PASSWORD_RESET_TOKEN_EXPIRES_IN="${{ secrets.PASSWORD_RESET_TOKEN_EXPIRES_IN }}" \
            . -t ${{ secrets.ACR_LOGIN_SERVER }}/unite-backend-dev:latest
          docker push ${{ secrets.ACR_LOGIN_SERVER }}/unite-backend-dev:latest
